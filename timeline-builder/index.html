<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Harpoon Timeline Builder v1.5.2 (rebased on v1.4)</title>

<style>
/* =========================================================
   BUILDER UI ONLY (never exported)
   ========================================================= */
body{
  font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  margin:0;
  padding:24px;
  background:#fafafa;
  color:#111;
}
h1{ font-size:22px; margin:0 0 14px; }
.builder{ max-width: 980px; margin:0 auto 40px; }
fieldset{
  background:#fff;
  border:1px solid #ddd;
  border-radius:12px;
  padding:16px;
  margin:0 0 16px;
}
label{ display:block; font-size:12px; font-weight:700; margin:10px 0 6px; }
input[type="text"], textarea, select{
  width:100%;
  box-sizing:border-box;
  padding:10px;
  border:1px solid #ccc;
  border-radius:10px;
  font-size:14px;
}
textarea{ min-height:92px; resize:vertical; }
.row{ display:grid; grid-template-columns: 1fr 1fr; gap:14px; align-items:end; }
.actions{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
button{
  appearance:none;
  border:0;
  border-radius:10px;
  padding:10px 14px;
  font-size:14px;
  cursor:pointer;
}
button.primary{ background:#111; color:#fff; }
button.secondary{ background:#eee; color:#111; }

.dot-picker{
  display:flex;
  align-items:center;
  gap:10px;
}
.dot-preview{
  width:14px;
  height:14px;
  border-radius:50%;
  border:1px solid #ccc;
  background:#7a1c5c;
  flex: 0 0 auto;
}

/* =========================================================
   PREVIEW FRAME (builder only)
   ========================================================= */
.preview{
  background:#fff;
  border:1px solid #ddd;
  border-radius:12px;
  overflow:hidden;
}
.preview__scroller{
  overflow-x:auto;
  -webkit-overflow-scrolling: touch;
  padding: 18px 0;
  cursor: grab;
  user-select: none;
}
.preview__scroller:active{ cursor: grabbing; }

/* =========================================================
   RUNTIME PREVIEW CSS (matches exported CSS)
   Scoped to .hp-timeline* only
   ========================================================= */

.hp-timeline-wrapper{
  overflow-x:auto;
  -webkit-overflow-scrolling: touch;
  touch-action: pan-x;
}

.hp-timeline{
  /* axis + styling */
  --hp-line-y: 40px;            /* axis position from top of timeline box */
  --hp-line-thickness: 3px;
  --hp-line-color: #d0a3c4;

  --hp-dot-color: #7a1c5c;
  --hp-dot-size: 12px;
  --hp-dot-border: 0px;         /* for open circle */
  --hp-dot-fill: var(--hp-dot-color);

  position: relative;
  display: flex;
  gap: 32px;

  /* IMPORTANT: no top padding here (this was the alignment bug) */
  padding: 0 20px 20px;

  width: max-content;
}

/* Line is centred on the axis */
.hp-timeline__line{
  position:absolute;
  top: var(--hp-line-y);
  left:0;
  right:0;
  height: var(--hp-line-thickness);
  background: var(--hp-line-color);
  opacity: .4;
  transform: translateY(-50%);
  pointer-events:none;
}

/* Each item creates the vertical space below the axis */
.hp-timeline__item{
  position:relative;
  width: min(320px, 88vw);
  flex-shrink:0;

  /* This is what creates spacing below the line without padding on the timeline itself */
  padding-top: calc(var(--hp-line-y) + var(--hp-dot-size) + 8px);
}

/* Marker is positioned in the SAME coordinate space as the line:
   - both are relative to .hp-timeline (no padding-top on timeline) */
.hp-timeline__marker{
  position:absolute;
  top: var(--hp-line-y);
  left: 50%;
  width: var(--hp-dot-size);
  height: var(--hp-dot-size);
  transform: translate(-50%, -50%);
  background: var(--hp-dot-fill);
  border: var(--hp-dot-border) solid var(--hp-dot-color);
  border-radius:50%;
  z-index:2;
}

/* Date sits between marker and card (like your GSAP version) */
.hp-timeline__date{
  margin: 0 0 12px;
  font-weight:700;
  text-align:center;
}

/* Card */
.hp-timeline__card{
  background:#fff;
  border-radius:16px;
  padding:16px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.08);
  border: 1px solid rgba(0,0,0,0.04);
}

/* Optional image */
.hp-timeline__image{
  width:100%;
  aspect-ratio: 16 / 9;
  border-radius:12px;
  background-size:cover;
  background-position:center;
  margin-bottom:6px;
}

/* Optional image credit (minimal so story typography still wins) */
.hp-timeline__credit{
  font-size:11px;
  text-align:right;
  opacity:.65;
  font-variant: all-small-caps;
  letter-spacing: .04em;
  margin: 0 0 10px;
}

/* =========================================================
   MODAL (builder only)
   ========================================================= */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.45);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.modal.open{ display:flex; }
.modal__box{
  width:min(980px, 92vw);
  background:#fff;
  border-radius:14px;
  overflow:hidden;
  box-shadow: 0 20px 80px rgba(0,0,0,.25);
}
.modal__tabs{
  display:flex;
  border-bottom:1px solid #ddd;
  background:#f7f7f7;
}
.modal__tabs button{
  flex:1;
  border-radius:0;
  background:transparent;
  font-weight:800;
  padding:12px;
}
.modal__tabs button.active{ background:#fff; }
.modal__content{
  padding:14px 16px;
  max-height: 60vh;
  overflow:auto;
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
  font-size: 12.5px;
  white-space: pre;
}
.modal__footer{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 16px;
  border-top:1px solid #ddd;
}
.toast{
  position:fixed;
  right:16px;
  bottom:16px;
  background:#111;
  color:#fff;
  padding:10px 12px;
  border-radius:10px;
  font-size:13px;
  opacity:0;
  transform: translateY(6px);
  transition: opacity .18s ease, transform .18s ease;
  pointer-events:none;
}
.toast.show{ opacity:1; transform: translateY(0); }
</style>
</head>

<body>
<div class="builder">
  <h1>Harpoon Timeline Builder v1.5.2</h1>

  <fieldset>
    <div class="row">
      <div>
        <label>Line colour</label>
        <input type="color" id="lineColor" value="#d0a3c4">
      </div>

      <div>
        <label>Marker colour</label>
        <div class="dot-picker">
          <span class="dot-preview" id="dotPreview" aria-hidden="true"></span>
          <input type="color" id="dotColor" value="#7a1c5c">
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:10px">
      <div>
        <label>Marker style</label>
        <select id="markerStyle">
          <option value="dot-small">Small dot</option>
          <option value="dot-big">Big dot</option>
          <option value="circle-open">Open circle</option>
        </select>
      </div>
      <div>
        <label>Line thickness</label>
        <select id="lineThickness">
          <option value="2">2px</option>
          <option value="3" selected>3px</option>
          <option value="4">4px</option>
        </select>
      </div>
    </div>
  </fieldset>

  <fieldset>
    <label>Date</label>
    <input type="text" id="dateInput" placeholder="e.g. 2024 – 2025">

    <label>Body text (HTML allowed)</label>
    <textarea id="textInput" placeholder="e.g. <p>Something happened…</p>"></textarea>

    <label>Image URL (optional)</label>
    <input type="text" id="imageInput" placeholder="https://…">

    <label>Image credit (optional)</label>
    <input type="text" id="creditInput" placeholder="e.g. BOAT INTERNATIONAL">

    <div class="actions">
      <button class="primary" id="addBtn" type="button">Add entry</button>
      <button class="secondary" id="exportBtn" type="button">Export HTML / CSS</button>
      <button class="secondary" id="clearBtn" type="button">Clear all</button>
    </div>
  </fieldset>

  <div class="preview">
    <div class="preview__scroller" id="previewScroller">
      <div class="hp-timeline-wrapper">
        <div class="hp-timeline" id="previewTimeline">
          <div class="hp-timeline__line"></div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Export modal -->
<div class="modal" id="modal" aria-hidden="true">
  <div class="modal__box" role="dialog" aria-modal="true" aria-label="Export HTML and CSS">
    <div class="modal__tabs">
      <button type="button" id="tabHtml" class="active">HTML</button>
      <button type="button" id="tabCss">CSS</button>
    </div>
    <div class="modal__content" id="modalContent"></div>
    <div class="modal__footer">
      <button type="button" class="secondary" id="closeModalBtn">Close</button>
      <button type="button" class="primary" id="copyBtn">Copy</button>
    </div>
  </div>
</div>

<div class="toast" id="toast">Copied</div>

<script>
(() => {
  const entries = [];
  let activeTab = "html";
  let lastAddedIndex = null;

  const $ = (id) => document.getElementById(id);

  const previewTimeline  = $("previewTimeline");
  const previewScroller  = $("previewScroller");

  const lineColor     = $("lineColor");
  const dotColor      = $("dotColor");
  const dotPreview    = $("dotPreview");
  const markerStyle   = $("markerStyle");
  const lineThickness = $("lineThickness");

  const dateInput   = $("dateInput");
  const textInput   = $("textInput");
  const imageInput  = $("imageInput");
  const creditInput = $("creditInput");

  const addBtn    = $("addBtn");
  const exportBtn = $("exportBtn");
  const clearBtn  = $("clearBtn");

  const modal         = $("modal");
  const tabHtml       = $("tabHtml");
  const tabCss        = $("tabCss");
  const modalContent  = $("modalContent");
  const closeModalBtn = $("closeModalBtn");
  const copyBtn       = $("copyBtn");
  const toast         = $("toast");

  function showToast(msg="Copied") {
    toast.textContent = msg;
    toast.classList.add("show");
    setTimeout(() => toast.classList.remove("show"), 1000);
  }

  function getMarkerVars() {
    // Default
    let dotSize = 12;
    let border  = 0;
    let fill    = "var(--hp-dot-color)";

    const style = markerStyle.value;

    if (style === "dot-small") {
      dotSize = 10; border = 0; fill = "var(--hp-dot-color)";
    } else if (style === "dot-big") {
      dotSize = 16; border = 0; fill = "var(--hp-dot-color)";
    } else if (style === "circle-open") {
      dotSize = 14; border = 2; fill = "transparent";
    }

    return { dotSize, border, fill };
  }

  function applyVars() {
    const { dotSize, border, fill } = getMarkerVars();

    previewTimeline.style.setProperty("--hp-line-color", lineColor.value);
    previewTimeline.style.setProperty("--hp-dot-color", dotColor.value);
    previewTimeline.style.setProperty("--hp-line-thickness", `${Number(lineThickness.value)}px`);
    previewTimeline.style.setProperty("--hp-dot-size", `${dotSize}px`);
    previewTimeline.style.setProperty("--hp-dot-border", `${border}px`);
    previewTimeline.style.setProperty("--hp-dot-fill", fill);

    // Keep the dot colour picker as a DOT, always
    dotPreview.style.background = dotColor.value;
    dotPreview.style.borderColor = styleIsOpenCircle() ? dotColor.value : "#ccc";
  }

  function styleIsOpenCircle(){
    return markerStyle.value === "circle-open";
  }

  function renderPreview(preserveScroll=true) {
    const prevX = preserveScroll ? previewScroller.scrollLeft : 0;

    // Keep the line as first child (spans full width)
    previewTimeline.innerHTML = '<div class="hp-timeline__line"></div>';

    entries.forEach((e, i) => {
      const item = document.createElement("div");
      item.className = "hp-timeline__item";
      item.dataset.idx = String(i);

      // Body is inserted as-is (producer-controlled)
      const bodyHTML = e.text || "";

      item.innerHTML = `
        <div class="hp-timeline__marker"></div>
        <div class="hp-timeline__date">${escapeHTML(e.date)}</div>
        <div class="hp-timeline__card">
          ${e.image ? `<div class="hp-timeline__image" style="background-image:url('${escapeAttr(e.image)}')"></div>` : ""}
          ${e.credit ? `<div class="hp-timeline__credit">${escapeHTML(e.credit)}</div>` : ""}
          ${bodyHTML}
        </div>
      `;

      previewTimeline.appendChild(item);
    });

    applyVars();
    if (preserveScroll) previewScroller.scrollLeft = prevX;

    // Keep the view near the card you're working on
    if (lastAddedIndex !== null) {
      const el = previewTimeline.querySelector(`[data-idx="${lastAddedIndex}"]`);
      if (el) el.scrollIntoView({ behavior: "smooth", inline: "center", block: "nearest" });
    }
  }

  function addEntry() {
    entries.push({
      date: dateInput.value.trim(),
      text: textInput.value.trim(),
      image: imageInput.value.trim(),
      credit: creditInput.value.trim()
    });

    lastAddedIndex = entries.length - 1;

    dateInput.value = "";
    textInput.value = "";
    imageInput.value = "";
    creditInput.value = "";

    renderPreview(true);
  }

  addBtn.addEventListener("click", addEntry);

  clearBtn.addEventListener("click", () => {
    entries.length = 0;
    lastAddedIndex = null;
    renderPreview(false);
  });

  lineColor.addEventListener("input", () => { applyVars(); if (modal.classList.contains("open") && activeTab==="css") renderModal(); });
  dotColor.addEventListener("input", () => { applyVars(); if (modal.classList.contains("open") && activeTab==="css") renderModal(); });
  markerStyle.addEventListener("change", () => { applyVars(); renderPreview(true); if (modal.classList.contains("open")) renderModal(); });
  lineThickness.addEventListener("change", () => { applyVars(); renderPreview(true); if (modal.classList.contains("open")) renderModal(); });

  // Export helpers
  function exportHTML() {
    const out = [];
    out.push('<div class="hp-timeline-wrapper">');
    out.push('  <div class="hp-timeline">');
    out.push('    <div class="hp-timeline__line"></div>');

    entries.forEach(e => {
      out.push('    <div class="hp-timeline__item">');
      out.push('      <div class="hp-timeline__marker"></div>');
      out.push(`      <div class="hp-timeline__date">${escapeHTML(e.date)}</div>`);
      out.push('      <div class="hp-timeline__card">');
      if (e.image)  out.push(`        <div class="hp-timeline__image" style="background-image:url('${escapeAttr(e.image)}')"></div>`);
      if (e.credit) out.push(`        <div class="hp-timeline__credit">${escapeHTML(e.credit)}</div>`);
      out.push(`        ${e.text || ""}`);
      out.push('      </div>');
      out.push('    </div>');
    });

    out.push('  </div>');
    out.push('</div>');
    return out.join("\n");
  }

  function exportCSS() {
    const { dotSize, border, fill } = getMarkerVars();
    return [
`/* Harpoon Timeline — runtime CSS (v1.5.2) */`,
`.hp-timeline-wrapper{`,
`  overflow-x:auto;`,
`  -webkit-overflow-scrolling:touch;`,
`  touch-action:pan-x;`,
`}`,
``,
`.hp-timeline{`,
`  --hp-line-y: 40px;`,
`  --hp-line-thickness: ${Number(lineThickness.value)}px;`,
`  --hp-line-color: ${lineColor.value};`,
``,
`  --hp-dot-color: ${dotColor.value};`,
`  --hp-dot-size: ${dotSize}px;`,
`  --hp-dot-border: ${border}px;`,
`  --hp-dot-fill: ${fill};`,
``,
`  position:relative;`,
`  display:flex;`,
`  gap:32px;`,
`  padding:0 20px 20px;`,
`  width:max-content;`,
`}`,
``,
`.hp-timeline__line{`,
`  position:absolute;`,
`  top:var(--hp-line-y);`,
`  left:0; right:0;`,
`  height:var(--hp-line-thickness);`,
`  background:var(--hp-line-color);`,
`  opacity:.4;`,
`  transform:translateY(-50%);`,
`  pointer-events:none;`,
`}`,
``,
`.hp-timeline__item{`,
`  position:relative;`,
`  width:min(320px, 88vw);`,
`  flex-shrink:0;`,
`  padding-top: calc(var(--hp-line-y) + var(--hp-dot-size) + 8px);`,
`}`,
``,
`.hp-timeline__marker{`,
`  position:absolute;`,
`  top:var(--hp-line-y);`,
`  left:50%;`,
`  width:var(--hp-dot-size);`,
`  height:var(--hp-dot-size);`,
`  transform:translate(-50%,-50%);`,
`  background:var(--hp-dot-fill);`,
`  border:var(--hp-dot-border) solid var(--hp-dot-color);`,
`  border-radius:50%;`,
`  z-index:2;`,
`}`,
``,
`.hp-timeline__date{`,
`  margin:0 0 12px;`,
`  font-weight:700;`,
`  text-align:center;`,
`}`,
``,
`.hp-timeline__card{`,
`  background:#fff;`,
`  border-radius:16px;`,
`  padding:16px;`,
`  box-shadow:0 10px 30px rgba(0,0,0,.08);`,
`  border:1px solid rgba(0,0,0,.04);`,
`}`,
``,
`.hp-timeline__image{`,
`  width:100%;`,
`  aspect-ratio:16/9;`,
`  border-radius:12px;`,
`  background-size:cover;`,
`  background-position:center;`,
`  margin-bottom:6px;`,
`}`,
``,
`.hp-timeline__credit{`,
`  font-size:11px;`,
`  text-align:right;`,
`  opacity:.65;`,
`  font-variant:all-small-caps;`,
`  letter-spacing:.04em;`,
`  margin:0 0 10px;`,
`}`,
    ].join("\n");
  }

  function openModal() {
    modal.classList.add("open");
    modal.setAttribute("aria-hidden", "false");
    renderModal();
  }

  function closeModal() {
    modal.classList.remove("open");
    modal.setAttribute("aria-hidden", "true");
  }

  function renderModal() {
    tabHtml.classList.toggle("active", activeTab==="html");
    tabCss.classList.toggle("active", activeTab==="css");
    modalContent.textContent = (activeTab==="html") ? exportHTML() : exportCSS();
  }

  exportBtn.addEventListener("click", openModal);
  closeModalBtn.addEventListener("click", closeModal);
  modal.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });

  tabHtml.addEventListener("click", () => { activeTab="html"; renderModal(); });
  tabCss.addEventListener("click", () => { activeTab="css"; renderModal(); });

  copyBtn.addEventListener("click", async () => {
    try{
      await navigator.clipboard.writeText(modalContent.textContent);
      showToast("Copied");
    }catch(e){
      showToast("Copy failed");
    }
  });

  // ---- Drag-to-scroll support for desktop (and some embedded contexts)
  // Mobile remains native momentum scroll; this adds mouse dragging without libraries.
  (() => {
    const scroller = previewScroller;
    let isDown = false;
    let startX = 0;
    let startScrollLeft = 0;

    scroller.addEventListener("mousedown", (e) => {
      isDown = true;
      startX = e.pageX;
      startScrollLeft = scroller.scrollLeft;
      scroller.classList.add("dragging");
    });

    window.addEventListener("mouseup", () => { isDown = false; scroller.classList.remove("dragging"); });

    scroller.addEventListener("mousemove", (e) => {
      if (!isDown) return;
      e.preventDefault();
      const dx = e.pageX - startX;
      scroller.scrollLeft = startScrollLeft - dx;
    });

    // Touch: do not interfere — native scroll handles it
  })();

  // ---- Tiny escaping helpers (keep Shorthand happy; avoid stray \" issues)
  function escapeHTML(str="") {
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;");
  }
  function escapeAttr(str="") {
    return String(str)
      .replaceAll("&","&amp;")
      .replaceAll("'","&#39;")
      .replaceAll("\"","&quot;")
      .replaceAll("<","&lt;")
      .replaceAll(">","&gt;");
  }

  // Init
  applyVars();
  renderPreview(false);
})();
</script>
</body>
</html>
